<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel del Profesor - ULEAM</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <header class="header">
        <div class="nav-container">
            <div class="logo">
                <img src="https://libros.uleam.edu.ec/wp-content/uploads/2024/06/cropped-LOGO-ULEAM-HORIZONTAL.png" alt="Logo ULEAM" style="height: 50px;">
                <h1>Sistema de Sílabos</h1>
            </div>
            <nav class="nav-links">
                <a href="panel-profesor.html" class="active">Inicio</a>
                <a href="crear-silabo.html">Crear Sílabo</a>
                <a href="#" onclick="auth.logout()">Cerrar Sesión</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="card">
            <h2>Bienvenido, <span id="professorName">Profesor</span></h2>
            <p>Panel de control para la gestión de sílabos académicos</p>
        </div>

        <div class="dashboard-grid" style="grid-template-columns: 2fr 1fr;">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Mis Sílabos</h3>
                    <div class="btn-group">
                        <button class="btn btn-outline" onclick="cargarTodosSilabos()">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                                <path d="M3 14.5A1.5 1.5 0 0 1 1.5 13V3A1.5 1.5 0 0 1 3 1.5h8a.5.5 0 0 1 0 1H3a.5.5 0 0 0-.5.5v10a.5.5 0 0 0 .5.5h10a.5.5 0 0 0 .5-.5V8a.5.5 0 0 1 1 0v5a1.5 1.5 0 0 1-1.5 1.5H3z"/>
                                <path d="m8.354 10.354 7-7a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0z"/>
                            </svg>
                            Todos
                        </button>
                        <button class="btn btn-outline" onclick="verBorradores()">
                            <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/>
                            </svg>
                            Borradores
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Asignatura</th>
                                <th>Estado</th>
                                <th>Última Modificación</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="syllabusTable">
                            <!-- Se llenará dinámicamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="card">
                <h3>Acciones Disponibles</h3>
                <div class="action-buttons">
                    <a href="crear-silabo.html" class="btn btn-primary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 4px;">
                            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                        </svg>
                        Crear Nuevo Sílabo
                    </a>
                </div>

                <div class="stats-section" style="margin-top: 2rem;">
                    <h4>Resumen</h4>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <span class="stat-label">Total de Sílabos</span>
                            <span class="stat-value" id="totalSilabos">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Aprobados</span>
                            <span class="stat-value text-success" id="silabosAprobados">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Pendientes</span>
                            <span class="stat-value text-warning" id="silabosPendientes">0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>© 2025 Universidad Laica Eloy Alfaro de Manabí</p>
        </div>
    </footer>

    <script src="js/auth.js"></script>
    <script src="js/syllabus.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar autenticación
            if (!auth.isAuthenticated() || !auth.hasRole('professor')) {
                window.location.href = 'index.html';
                return;
            }

            // Cargar datos del usuario
            const user = auth.getCurrentUser();
            document.getElementById('professorName').textContent = user.name;

            // Cargar sílabos (simulado)
            loadSyllabus();
        });

        function loadSyllabus() {
            const user = auth.getCurrentUser();
            const syllabusList = syllabusManager.getSyllabusByProfessor(user.name);

            const tbody = document.getElementById('syllabusTable');
            tbody.innerHTML = syllabusList.map(item => `
                <tr>
                    <td>${item.subject}</td>
                    <td>
                        <span class="status-badge status-${item.status}">
                            ${getStatusName(item.status)}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-outline" onclick="editarSilabo(${item.id})">
                            ${item.status === 'rejected' ? 'Corregir' : 'Editar'}
                        </button>
                        ${item.comments ? `
                            <button class="btn btn-outline" onclick="verComentarios(${item.id})">
                                Ver Comentarios
                            </button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function getStatusName(status) {
            const names = {
                borrador: 'Borrador',
                revision: 'En Revisión',
                aprobado: 'Aprobado',
                rechazado: 'Rechazado'
            };
            return names[status] || status;
        }

        function editarSilabo(id) {
            window.location.href = `crear-silabo.html?id=${id}`;
        }

        function verBorradores() {
            const user = auth.getCurrentUser();
            const borradores = syllabusManager.getSyllabusByStatus('draft')
                .filter(s => s.professor === user.name);
            
            if (borradores.length === 0) {
                auth.showNotification('No hay borradores disponibles', 'info');
                return;
            }

            const tbody = document.getElementById('syllabusTable');
            tbody.innerHTML = borradores.map(item => `
                <tr>
                    <td>${item.subject}</td>
                    <td><span class="status-badge status-draft">Borrador</span></td>
                    <td>
                        <button class="btn btn-outline" onclick="editarSilabo(${item.id})">
                            Editar
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function verComentarios(id) {
            const silabo = syllabusManager.getSyllabusById(id);
            if (silabo && silabo.comments) {
                alert(`Comentarios de la revisión:\n\n${silabo.comments}\n\nRevisado por: ${silabo.reviewedBy}`);
            }
        }
    </script>
</body>
</html>